---
title: 操作系统-作业二
date: 2022-04-22 23:15:23
tags:
- 操作系统
categories:
- 操作系统
- 作业
---

实现一程序，分别在Windows、Linux操作系统下验证:

- 栈、堆、数据区是否可读可写不可执行
- 代码段是否可读可执行不可写

截止时间：2022.4.22

<!--more-->

```cpp
#include <iostream>
#include <stdlib.h>
#include <stdio.h>
#include <sys/time.h>
using namespace std;

//数据段
int DataArea;

void* Stack( int x )    //代码段
{
    int StackArea;      //栈

    cout<<endl;
    cout<<"StackValue   "<<StackArea<<endl;
    cout<<"HeapAddress "<<&StackArea<<endl;
    cout<<"Readable"<<endl;
    cout<<endl;

    cout<<"Trying writing... "<<endl;
    *(&StackArea) = 12;
    cout<<"Value after change: "<<StackArea<<endl;
    cout<<"Writable"<<endl;
    cout<<endl;
}

int CodeArea( int y )
{
    cout<<"CodeArea is executing"<<endl;
    cout<<"Ending..."<<endl;
    return 0;
}

int main()
{
    int ch = 1;
    float time_use=0;
    struct timeval start;
    struct timeval end;//struct timezone tz;

    static void* p;
    char* HeapArea = ( char* ) malloc ( sizeof( char ) );  //堆段


    while( ch != 0 )
    {
        cout<<"_______________________________________________________________________"<<endl;
        cout<<"please select: "<<endl;
        cout<<"1.DataSegment    2.CodeSegment   3.StackSegment  4.HeapSegment   0.exit"<<endl;
        cout<<"_______________________________________________________________________"<<endl;
        cin>>ch;


        if( ch == 1 )
        {
            //dataseg
            cout<<endl;
            cout<<"DataValue   "<<DataArea<<endl;
            cout<<"DataAddress "<<&DataArea<<endl;
            cout<<"Readable"<<endl;
            cout<<endl;

            cout<<"Trying writing... "<<endl;
            *(&DataArea) = 21;
            cout<<"Value after change: "<<DataArea<<endl;
            cout<<"Writable"<<endl;
            cout<<endl;
        }
        else if( ch == 2 )
        {
            //codeseg
            cout<<endl;
            cout<<"CodeValue   "<<CodeArea<<endl;
            cout<<"CodeAddress "<<&CodeArea<<endl;
            cout<<"Readable"<<endl;
            cout<<endl;

            cout<<"Trying writing... "<<endl;
            //*(&CodeArea) = 21;
            cout<<"CodeBlocks warning-> error: assignment of read-only location '* CodeArea'|"<<endl;
            cout<<"Unwritable"<<endl;
            cout<<endl;

            cout<<"Now execute-> "<<endl;
            (void (*)())&CodeArea;//将地址转换为函数指针运行
            (*(void (*)())&CodeArea)();
            cout<<"<- Executable"<<endl;
            cout<<endl;

        }
        else if( ch == 3 )
        {
            //stackseg
            Stack(1);
        }
        else if( ch == 4 )
        {
            //heapseg
            cout<<endl;
            cout<<"HeapValue   "<<HeapArea<<endl;
            cout<<"HeapAddress "<<&HeapArea<<endl;
            cout<<"Readable"<<endl;
            cout<<endl;

            cout<<"Trying writing... "<<endl;
            *(&HeapArea) = "HEAP";
            cout<<"Value after change: "<<DataArea<<endl;
            cout<<"Writable"<<endl;
            cout<<endl;

        }
        else if( ch == 0 )
        {
            system("pause");
        }
    }
    return 0;
}
```

